<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Qwen3-TTS Inno France</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/unified_styles.css') }}">
  </head>
  <body>
    <main class="container">
      <header class="header">
        <div class="brand">Qwen3-TTS Inno France</div>
        <div class="subtitle">基于Qwen3-TTS的产品级语音合成解决方案</div>
      </header>

      <section class="card">
        <div class="tabs">
          <button class="tab-button active" data-tab="voice-design">声音设计</button>
          <button class="tab-button" data-tab="voice-clone">声音克隆</button>
        </div>

        <div class="tab-content">
          <!-- 声音设计 Tab -->
          <div id="voice-design" class="tab-pane active">
            <div class="form-group">
              <label class="label" for="design-text">文本内容:</label>
              <textarea id="design-text" class="textarea" placeholder="请输入要合成的文本..."></textarea>
            </div>

            <div class="row">
              <div class="form-group">
                <label class="label" for="design-language">语言:</label>
                <select id="design-language" class="select">
                  <option value="Chinese">中文</option>
                  <option value="English">英文</option>
                  <option value="Japanese">日文</option>
                  <option value="Korean">韩文</option>
                </select>
              </div>

              <div class="form-group">
                <label class="label" for="design-speed">播放速度:</label>
                <input type="range" id="design-speed" class="range-input" min="1.0" max="2.0" step="0.1" value="1.0">
                <span id="design-speed-value" class="range-value">1.0</span>
              </div>
            </div>

            <div class="form-group">
              <label class="label" for="design-instruct">声音描述:</label>
              <input type="text" id="design-instruct" class="input" placeholder="例如：年轻女性声音，语调活泼">
            </div>

            <div class="form-group">
              <label class="label" for="design-output">输出文件名:</label>
              <input type="text" id="design-output" class="input" value="output_voice_design.wav">
            </div>

            <button id="design-btn" class="button" type="button">生成声音</button>

            <div id="design-result" class="result-section">
              <h3>生成结果</h3>
              <audio id="design-audio" class="audio-player" controls></audio>
              <a id="design-download" class="download-link" download>下载音频文件</a>
            </div>
          </div>

          <!-- 声音克隆 Tab -->
          <div id="voice-clone" class="tab-pane">
            <div class="form-group">
              <label class="label" for="clone-text">文本内容 (使用[SPEAKER0]、[SPEAKER1]等标记):</label>
              <textarea id="clone-text" class="textarea" placeholder="请输入要合成的文本，使用说话人标记..."></textarea>
            </div>

            <div class="form-group">
              <label class="label" for="clone-speakers">说话人配置 (JSON格式):</label>
              <textarea id="clone-speakers" class="textarea" placeholder='[{"design_text": "参考文本", "design_instruct": "声音描述", "language": "Chinese"}]'></textarea>
            </div>

            <div class="row">
              <div class="form-group">
                <label class="label" for="clone-speed">播放速度:</label>
                <input type="range" id="clone-speed" class="range-input" min="1.0" max="2.0" step="0.1" value="1.0">
                <span id="clone-speed-value" class="range-value">1.0</span>
              </div>

              <div class="form-group">
                <label class="label" for="clone-output">输出文件名:</label>
                <input type="text" id="clone-output" class="input" value="output_voice_clone.wav">
              </div>
            </div>

            <button id="clone-btn" class="button" type="button">克隆声音</button>

            <div id="clone-result" class="result-section">
              <h3>生成结果</h3>
              <audio id="clone-audio" class="audio-player" controls></audio>
              <a id="clone-download" class="download-link" download>下载音频文件</a>
            </div>
          </div>
        </div>
      </section>

      <footer class="footer">
        <div>&copy; 2026 Inno France. All rights reserved.</div>
      </footer>
    </main>

    <script>
      // Tab切换功能
      document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', () => {
          // 移除所有激活状态
          document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
          document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
          
          // 激活当前标签
          button.classList.add('active');
          const tabId = button.getAttribute('data-tab');
          document.getElementById(tabId).classList.add('active');
        });
      });

      // 速度滑块值显示
      document.getElementById('design-speed').addEventListener('input', function() {
        document.getElementById('design-speed-value').textContent = this.value;
      });

      document.getElementById('clone-speed').addEventListener('input', function() {
        document.getElementById('clone-speed-value').textContent = this.value;
      });

      // 声音设计功能
      document.getElementById('design-btn').addEventListener('click', function() {
        const text = document.getElementById('design-text').value;
        const language = document.getElementById('design-language').value;
        const speed = document.getElementById('design-speed').value;
        const instruct = document.getElementById('design-instruct').value;
        const output = document.getElementById('design-output').value;

        // 显示加载状态
        const resultSection = document.getElementById('design-result');
        resultSection.innerHTML = '<div class="loading"><div class="spinner"></div><div>正在生成声音...</div></div>';
        resultSection.style.display = 'block';

        // 发送请求
        fetch('/voice_design', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            text: text,
            language: language,
            speed: parseFloat(speed),
            instruct: instruct,
            output_path: output
          })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            resultSection.innerHTML = `
              <h3>生成结果</h3>
              <audio id="design-audio" class="audio-player" controls>
                <source src="${data.audio_url}" type="audio/wav">
              </audio>
              <a id="design-download" class="download-link" href="${data.audio_url}" download="${output}">下载音频文件</a>
            `;
            resultSection.style.display = 'block';
          } else {
            resultSection.innerHTML = `<div class="statusText err">错误: ${data.error}</div>`;
            resultSection.style.display = 'block';
          }
        })
        .catch(error => {
          resultSection.innerHTML = `<div class="statusText err">网络错误: ${error.message}</div>`;
        });
      });

      // 声音克隆功能
      document.getElementById('clone-btn').addEventListener('click', function() {
        const text = document.getElementById('clone-text').value;
        const speakers = document.getElementById('clone-speakers').value;
        const speed = document.getElementById('clone-speed').value;
        const output = document.getElementById('clone-output').value;

        // 显示加载状态
        const resultSection = document.getElementById('clone-result');
        resultSection.innerHTML = '<div class="loading"><div class="spinner"></div><div>正在克隆声音...</div></div>';
        resultSection.style.display = 'block';

        // 发送请求
        fetch('/voice_clone', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            text: text,
            speaker_configs: JSON.parse(speakers),
            speed: parseFloat(speed),
            output_path: output
          })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            resultSection.innerHTML = `
              <h3>生成结果</h3>
              <audio id="clone-audio" class="audio-player" controls>
                <source src="${data.audio_url}" type="audio/wav">
              </audio>
              <a id="clone-download" class="download-link" href="${data.audio_url}" download="${output}">下载音频文件</a>
            `;
            resultSection.style.display = 'block';
          } else {
            resultSection.innerHTML = `<div class="statusText err">错误: ${data.error}</div>`;
            resultSection.style.display = 'block';
          }
        })
        .catch(error => {
          resultSection.innerHTML = `<div class="statusText err">网络错误: ${error.message}</div>`;
        });
      });

    // 初始化显示第一个标签页的内容
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelector('.tab-content').classList.add('active');
      document.getElementById('voice-design').classList.add('active');
    });
    </script>
  </body>
</html>